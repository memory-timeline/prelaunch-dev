"use strict";(self.webpackChunkprelaunch=self.webpackChunkprelaunch||[]).push([[621],{94606:function(e,t,n){var a=n(74165),o=n(15861),r=n(17381);function i(){return(i=(0,o.Z)((0,a.Z)().mark((function e(t,n){var o,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o={body:n,method:"PUT"},e.next=4,fetch(t,o).then((function(e){return e}));case 4:return r=e.sent,e.abrupt("return",r);case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}t.Z={newCollage:function(e,t){try{var n={collage_id:e};return r.Z.post("authbridge-stage.mymemorystore.in","/api/collage/new",n,JSON.stringify(t))}catch(a){return console.log(a),a}},saveCollage:function(e,t){try{var n={collage_id:e};return r.Z.post("authbridge-stage.mymemorystore.in","/api/collage/save",n,JSON.stringify(t))}catch(a){return console.log(a),a}},upload:function(e,t){return i.apply(this,arguments)},listCollages:function(e){try{var t={next_token:e};return r.Z.get("authbridge-stage.mymemorystore.in","/api/collage/list",t)}catch(n){return console.log(n),n}},getThumbnail:function(e){try{var t={collage_id:e};return r.Z.get("authbridge-stage.mymemorystore.in","/api/collage/thumbnail",t)}catch(n){return console.log(n),n}},getCollage:function(e){try{var t={collage_id:e};return r.Z.get("authbridge-stage.mymemorystore.in","/api/collage/get",t)}catch(n){return console.log(n),n}},deleteCollage:function(e){try{var t={collage_id:e};return r.Z.deleteMethod("authbridge-stage.mymemorystore.in","/api/collage/delete",t)}catch(n){return console.log(n),n}},checkOptimizeStatus:function(e){try{var t={collage_id:e};return r.Z.get("authbridge-stage.mymemorystore.in","/api/collage/resized-count",t)}catch(n){return console.log(n),n}}}},17381:function(e,t,n){var a=n(74165),o=n(15861),r=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var o,r,i,l,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>2&&void 0!==s[2]?s[2]:{},r="https://".concat(t).concat(n),i={method:"GET",credentials:"include",headers:new Headers({"content-type":"application/json"})},r+="?".concat(new URLSearchParams(o).toString()),e.next=6,fetch(r,i);case 6:if((l=e.sent).ok){e.next=13;break}if(401!==l.status){e.next=11;break}return document.cookie="userInfo=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",e.abrupt("return",{status:"unauthenticated"});case 11:if(403!==l.status){e.next=13;break}return e.abrupt("return",{status:"forbidden"});case 13:return e.abrupt("return",l.json());case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,o,r){var i,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="https://".concat(t).concat(n),i+="?".concat(new URLSearchParams(o).toString()),l={method:"POST",credentials:"include",headers:new Headers({"content-type":"application/json"}),body:r},e.abrupt("return",fetch(i,l).then((function(e){return e.ok?e.json():{status:"error"}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,o){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://".concat(t).concat(n),r+="?".concat(new URLSearchParams(o).toString()),i={method:"DELETE",credentials:"include",headers:new Headers({"content-type":"application/json"})},e.abrupt("return",fetch(r,i).then((function(e){return e.ok?e.json():{status:"error"}})));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();t.Z={get:r,post:i,deleteMethod:l}},44768:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(32913),o=n(36151),r=n(80184);function i(e){var t=e.children,n=e.onClick,a=e.name;return(0,r.jsx)(o.Z,{id:a,variant:"contained",component:"label",onClick:n,sx:{color:"muted.main",borderRadius:15,backgroundColor:"button.main",padding:"6px 8px","&:hover":{color:"muted.main",backgroundColor:"button.main"}},children:t})}i.defaultProps={onClick:function(){}};var l=n(20890);function s(e){var t=e.handleChange;return(0,r.jsxs)(i,{name:"add",children:[(0,r.jsx)("input",{type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:t}),(0,r.jsx)(a.Z,{sx:{fontSize:"2rem"}}),(0,r.jsx)(l.Z,{sx:{fontWeight:"bold"},children:"Add Images"})]})}},18253:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(74165),o=n(15861),r=n(36151),i=n(12065),l=n(80184);function s(e){var t=e.authURL,n=e.next,s=e.handlePreLogin,c=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:console.log("pre logn handdled",n,t),o=""!==n?"https://".concat(t,"/oauth2/authorize?next=").concat(n):"https://".concat(t,"/oauth2/authorize"),window.location.replace(o);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,l.jsx)(r.Z,{type:"submit",variant:"outlined",onClick:c,sx:{borderRadius:"5px",borderColor:"white",fontWeight:"bold",color:"white","&:hover":{color:"white",borderColor:"white",backgroundColor:(0,i.Fq)("#fff",.1)}},children:"Login"})}s.defaultProps={handlePreLogin:function(){}}},92622:function(e,t,n){var a=n(74165),o=n(15861),r=n(27076);function i(e){return l.apply(this,arguments)}function l(){return(l=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.Z.collageDB[t].toArray();case 2:if(n=e.sent,console.log("collage data getData",t,n),!n.length){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(e){return r.Z.collageDB[e].clear()}function c(){return u.apply(this,arguments)}function u(){return(u=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i("details");case 2:if(t=e.sent,console.log("in get collage details",t),!t.length){e.next=6;break}return e.abrupt("return",t[0]);case 6:return e.abrupt("return",{});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){s("details"),s("images")}function d(){return(d=(0,o.Z)((0,a.Z)().mark((function e(){var t,n,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c();case 2:if(t=e.sent,console.time("collage data get images"),n=[],!("images"in t&&t.images.length>0)){e.next=11;break}return e.next=8,Promise.allSettled(t.images.map((function(e){return r.Z.collageDB.images.get(e.title)})));case 8:n=e.sent,e.next=12;break;case 11:h();case 12:return console.timeEnd("collage data get images"),console.log("get collage data",t,[],n),o=n.map((function(e){return e.value})),e.abrupt("return",{details:t,images:o});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=(0,o.Z)((0,a.Z)().mark((function e(t,n){var o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("save collage data",t,n),e.next=3,Promise.allSettled(t.map((function(e){return r.Z.collageDB[n].put(e)})));case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=(0,o.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("delete collage data",t,n),r.Z.collageDB[n].delete(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.Z={getCollageData:function(){return d.apply(this,arguments)},clearCollageData:h,save:function(e,t){return g.apply(this,arguments)},remove:function(e,t){return f.apply(this,arguments)},clearData:s}},74144:function(e,t,n){var a=n(74165),o=n(15861),r=n(93433),i=n(29439),l=n(37762);function s(e,t,n,a){return a-e[t]>=e[n]-a?n:t}function c(e,t,n,a){var o=document.createElement("canvas");return o.width=t,o.height=n,o.getContext("2d").drawImage(e,0,0,t,n),o.toDataURL(a)}function u(e,t,n){console.time("getImages optimize");var a=document.createElement("canvas");a.width=t,a.height=n,a.getContext("2d").drawImage(e,0,0,t,n);var o=a.toDataURL("image/webp",.3);return console.timeEnd("getImages optimize"),o}function h(e){return console.log("convert base64",e),new Promise((function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){t(a.result)},a.onerror=function(e){n(e)}}))}function d(){return d=(0,o.Z)((0,a.Z)().mark((function e(t,n,r,i){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.target.files&&(n((function(e){return e+t.target.files.length})),r(t.target.files.length),Array.from(t.target.files).map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).onload=function(e){var a=e.target,o=a.naturalWidth,r=a.naturalHeight,l=a.src,s="".concat(Date.now(),"-").concat(t.name);console.log("handle image load",s);var c=o/r;console.time("handle image load optimize",s);var h=u(n,1500,1500/c);console.timeEnd("handle image load optimize",s),console.log("image size",s,t.size,h.length);var d={title:s,src:h,originalSRC:l,originalHeight:r,originalWidth:o,naturalHeight:1500/c,naturalWidth:1500,aspectRatio:c,type:t.type,file:t};i(d)},e.next=4,h(t);case 4:n.src=e.sent;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function g(e,t,n){var a=e/t;return a<n?[e,e/n]:a>n?[t*n,t]:[e,t]}function f(e,t,n,a,o,r){if(0===e.length)return[];var i=document.createElement("canvas");i.width=a-16,i.height=1e3;var l=i.getContext("2d");l.font="".concat(o,"px Arial"),l.textAlign="center";for(var s=t,c=n,u=e.split(" "),h="",d="",g=[],f=0;f<u.length;f+=1){d+="".concat(u[f]," ");var p=l.measureText(d).width;console.log("wrap text ",h,d,p,i.width,l.letterSpacing),p>i.width&&f>0?(g.push([h,s,c]),c+=r,h="".concat(u[f]," "),d="".concat(u[f]," ")):h+="".concat(u[f]," "),f===u.length-1&&g.push([h,s,c])}return g}function p(e,t,n,a,o,r,i){return f(e,t,n,a,o*i,r*i).length*r*i}t.Z={getCut:function(){return["v","h"][Math.round(Math.random())]},findClosest:function(e,t){var n=e.length;if(t<=e[0])return 0;if(t>=e[n-1])return n-1;for(var a=0,o=n,r=0;a<o;){if(e[r=(a+o)/2]===t)return r;if(t<e[r]){if(r>0&&t>e[r-1])return s(e,r-1,r,t);o=r}else{if(r<n-1&&t<e[r+1])return s(e,r,r+1,t);a=r+1}}return r},findImgPair:function(e,t){for(var n=0,a=e.length-1,o=n,r=a,i=Math.abs(e[n]+e[a]-t);n<=a;)if(e[n]+e[a]>t)Math.abs(e[n]+e[a]-t)<i&&(i=Math.abs(e[n]+e[a]-t),o=n,r=a),a-=1;else{if(!(e[n]+e[a]<=t)){o=n,r=a;break}Math.abs(e[n]+e[a]-t)<i&&(i=Math.abs(e[n]+e[a]-t),o=n,r=a),n+=1}return Math.round(Math.random())?[o,r]:[r,o]},getAspectRatio:function(e,t,n){return"v"===e?t+n:t*n/(t+n)},handleImageLoad:function(e,t,n,a){return d.apply(this,arguments)},resizeImages:function(e,t,n,a){var o=[];e.forEach((function(e){var i=new Image;i.onload=function(){var l=e.title,s=e.aspectRatio,u=e.type,h={title:l,src:c(i,t,t/s,e.type),naturalHeight:t/s,naturalWidth:t,aspectRatio:s,type:u};o.push(h),n((function(t){var n=t.findIndex((function(t){return t.title===e.title}));return[].concat((0,r.Z)(t.slice(0,n)),[h],(0,r.Z)(t.slice(n+1)))})),a(h)},i.src=e.src}))},wrapText:f,convertToRGBA:function(e){return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")")},getCollageDimension:g,downscaleImage:c,convertBase64:h,convertBase64String:function(e){return new Promise((function(t,n){var a=new FileReader;a.readAsD(new Blob(e)),a.onload=function(){t(a.result)},a.onerror=function(e){n(e)}}))},textCanvasDraw:function(e,t,n,a,o,r){e.font="".concat(20*a,"px Arial"),e.textAlign="center",e.textBaseline="top",e.fillStyle="#1c1c1cb3",e.fillRect(0,n,o,n+r),e.fillStyle="white",console.log("text array",t,r);var s,c=(0,l.Z)(t);try{for(c.s();!(s=c.n()).done;){var u=s.value,h=(0,i.Z)(u,3),d=h[0],g=h[2];e.fillText(d,o/2,g+n+2.5*a)}}catch(f){c.e(f)}finally{c.f()}},getTextHeight:p,getImageDimensions:function(e,t,n,a,o,r,i,l,s){return g(e,t-p(n,a,o,e,r,i,l),s)},optimizeDimensions:function(e,t,n){var a=e/t,o=n.map((function(n){var o=e*n.value.naturalWidth/n.value.width,r=o/a;return[e-o+t-r,[o,r]]}));return o.sort((function(e,t){return t[0]-e[0]})),console.log("optimun tree sizes",o,n,e,t),o[0][1]},optimizeImage:u}},36194:function(e,t,n){n.d(t,{S:function(){return j},Z:function(){return S}});var a=n(29439),o=n(72791),r=n(61889),i=n(64554),l=n(93044),s=n(80911),c=n(23786),u=n(57064),h=n(94721),d=n(13400),g=n(20068),f=n(6488),p=n(20890),v=n(49900),x=n(50533),m=n(12065),Z=n(76476),b=n(9052),C=n(80184);function j(e){var t=e.name,n=e.picture,a=e.email,o=Array.from(a)[0].toUpperCase();return(0,C.jsx)(l.Z,{sx:{borderRadius:"50%",borderColor:(0,m.Fq)("#fff",.8),referrerPolicy:"no-referrer"},alt:t,src:n,children:o})}function w(e){var t=e.name,n=e.email,a=e.open,o=e.handleClick,r=e.avatar;return(0,C.jsx)(i.Z,{sx:{display:"flex",alignItems:"center",textAlign:"center",marginRight:"10px"},children:(0,C.jsx)(g.Z,{title:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(p.Z,{children:t}),(0,C.jsx)(p.Z,{children:n})]}),children:(0,C.jsx)(d.Z,{onClick:o,size:"small","aria-controls":a?"account-menu":void 0,"aria-haspopup":"true","aria-expanded":a?"true":void 0,sx:{ml:2},children:r})})})}function y(e){var t=e.name,n=e.open,a=e.handleClose,o=e.anchorEl,r=e.avatar,i=e.email,l=t||i;return(0,C.jsxs)(s.Z,{anchorEl:o,id:"account-menu",open:n,onClose:a,onClick:a,PaperProps:{elevation:0,sx:{filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[(0,C.jsxs)(c.Z,{children:[r,(0,C.jsx)(v.Z,{children:l})]}),(0,C.jsx)(h.Z,{}),(0,C.jsx)(x.Z,{href:"https://".concat("authbridge-stage.mymemorystore.in","/oauth2/logout"),underline:"none",sx:{alignItems:"center",display:"flex"},children:(0,C.jsxs)(c.Z,{children:[(0,C.jsx)(u.Z,{children:(0,C.jsx)(f.Z,{fontSize:"small"})}),(0,C.jsx)(p.Z,{sx:{color:"muted.main"},children:"Logout"})]})})]})}function k(){var e=o.useState(null),t=(0,a.Z)(e,2),n=t[0],r=t[1],i=Boolean(n),l=b.Z.getUserInfo(),s=(0,C.jsx)(j,{name:l.name,picture:l.picture,email:l.email});return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(w,{avatar:s,open:i,email:l.email,handleClick:function(e){return r(e.currentTarget)},name:l.name}),(0,C.jsx)(y,{anchorEl:n,avatar:s,handleClose:function(){return r(null)},name:l.name,email:l.email,open:i})]})}function S(){return(0,C.jsx)(r.ZP,{item:!0,sx:{paddingTop:"0.3rem"},children:(0,C.jsx)(Z.Z,{children:(0,C.jsx)(k,{})})})}y.defaultProps={anchorEl:""}},27076:function(e,t,n){var a=new(n(51447).ZP)("collage");a.version(1).stores({images:"title, src,originalSRC,originalHeight, originalWidth, naturalWidth,naturalHeight,aspectRatio,type,targetAspectRatio,file",details:"++id, details"}),t.Z={collageDB:a}},76476:function(e,t,n){var a=n(29439),o=n(72791),r=n(57689),i=n(5574),l=n(65661),s=n(97123),c=n(39157),u=n(36151),h=n(9052),d=n(80184);function g(e){var t=e.open,n=e.onLogin;return console.log("auth dialog",t),(0,d.jsxs)(i.Z,{open:t,fullWidth:!0,children:[(0,d.jsx)(l.Z,{sx:{textAlign:"center"},children:"Login"}),(0,d.jsx)(c.Z,{dividers:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:"Please login to your account to complete this action"}),(0,d.jsx)(s.Z,{children:(0,d.jsx)(u.Z,{variant:"outlined",onClick:n,sx:{color:"primary",fontWeight:"bold"},children:"Login"})})]})}function f(e){var t=e.children,n=e.nextPath,i=(0,o.useState)(!0),l=(0,a.Z)(i,2),s=l[0],c=l[1],u=(0,r.TH)(),f=""!==h.Z.getUserInfo();if(console.log("auth",s),!0===f)return t;return n?(0,d.jsx)(r.Fg,{to:n,replace:!0}):(0,d.jsx)(g,{open:s,onLogin:function(){var e="https://".concat("authbridge-stage.mymemorystore.in","/oauth2/authorize?next=").concat(u.pathname).concat(u.search);window.location.replace(e)},onClose:function(){return c(!1)}})}f.defaultProps={nextPath:""},t.Z=f},82621:function(e,t,n){n.r(t),n.d(t,{default:function(){return ot}});var a=n(74165),o=n(15861),r=n(29439),i=n(27076),l=n(72791),s=n(92622),c=n(4942),u=n(1413),h=n(74144);var d=n(45987),g=n(93433),f=["file","src","originalSRC","originalWidth","originalHeight"],p=["file","src","originalSRC"];var v=n(15671),x=n(43144),m=n(64554),Z=n(20890),b=n(12065),C=n(80184);function j(e,t){return(0,C.jsx)(C.Fragment,{children:e.map((function(e){return(0,C.jsx)(Z.Z,{sx:{width:"100%",position:"absolute",top:t+e[2],bgcolor:(0,b.Fq)("#1c1c1c",.7),paddingX:1,color:"button.main",textAlign:"center",fontFamily:"Arial",fontSize:"20px",lineHeight:"25px",letterSpacing:"normal"},children:e[0]},e[2])}))})}var w=n(13400),y=n(27247),k=n(20068),S=["src","originalSRC"],R=function(){function e(t){(0,v.Z)(this,e),this.value=t,this.left=null,this.right=null}return(0,x.Z)(e,[{key:"fromObject",value:function(t){return null!=t?(this.value=t.value,null!=t.left&&(this.left=new e(t.left.value),this.left.fromObject(t.left)),null!=t.right&&(this.right=new e(t.right.value),this.right.fromObject(t.right)),this):null}},{key:"getScore",value:function(){return"cut"in this.value?[].concat((0,g.Z)(this.left.getScore()),(0,g.Z)(this.right.getScore())):[this.value.width+this.value.height]}},{key:"display",value:function(){var e=[],t=this.value,n=t.cut,a=t.title,o=t.aspectRatio;return null===this?null:("cut"in this.value&&e.push([n,o]),"title"in this.value&&e.push([a,o]),null!==this.left&&(e=e.concat(this.left.display())),null!==this.right&&(e=e.concat(this.right.display())),e)}},{key:"copy",value:function(){if(null===this)return null;var t=new e((0,u.Z)({},this.value));return null!=this.left&&(t.left=this.left.copy()),null!=this.right&&(t.right=this.right.copy()),t}},{key:"replaceImages",value:function(e){var t=this;if(null!==this){if("title"in this.value){var n=e.findIndex((function(e){return e.title===t.value.title})),a=e[n];this.value.src=a.originalSRC,this.value.naturalWidth=a.originalWidth,this.value.naturalHeight=a.originalHeight}null!=this.left&&this.left.replaceImages(e),null!=this.right&&this.right.replaceImages(e)}}},{key:"removeImageData",value:function(){if(null!==this){if("title"in this.value){var e=this.value,t=(e.src,e.originalSRC,(0,d.Z)(e,S));this.value=t}null!=this.left&&this.left.removeImageData(),null!=this.right&&this.right.removeImageData()}}},{key:"addImageData",value:function(e){var t=this;if(null!==this){if("title"in this.value){var n=e.find((function(e){return e.title===t.value.title}));this.value.src=n.src}null!=this.left&&this.left.addImageData(e),null!=this.right&&this.right.addImageData(e)}}},{key:"RenderImage",value:function(e,t,n,a,o,r,i){var l=this.value,s=l.width,c=l.title,u=l.src,h=l.x+r,d=l.y+o;return console.log("rendering image",c),(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(m.Z,{component:"img",title:c,alt:c,width:s,onLoad:function(){i(),console.log("loaded",c)},src:u,sx:{position:"absolute",padding:"".concat(e,"px"),borderRadius:"".concat(t,"px"),left:this.value.x+r,top:this.value.y+o}},c),!0===n?(0,C.jsx)(k.Z,{title:"Remove Image",children:(0,C.jsx)(w.Z,{size:"medium",sx:{color:(0,b.Fq)("#000",.7),bgcolor:(0,b.Fq)("#fff",.5),position:"absolute",top:d+e,left:h+e,padding:"".concat(e,"px"),borderRadius:"0 0 5px 0"},onClick:function(){return a(c)},children:(0,C.jsx)(y.Z,{size:"medium"})})}):null]})}},{key:"DOMDisplay",value:function(e,t,n,a,o,r,i){console.log("node dom display",e,t,n,a,o,r,this.value.title);var l=this.value.cut;return null===this?null:l?(console.log(this.right,this.left),(0,C.jsxs)(C.Fragment,{children:[null!=this.left?this.left.DOMDisplay(e,t,n,a,o,r,i):null,null!=this.right?this.right.DOMDisplay(e,t,n,a,o,r,i):null]})):"title"in this.value?this.RenderImage(e,t,n,a,o,r,i):null}},{key:"ResizeImage",value:function(e){var t=document.createElement("canvas");t.width=this.value.naturalWidth,t.height=this.value.naturalHeight;var n,a,o=t.getContext("2d"),r=this.value.naturalWidth,i=this.value.naturalHeight,l=Math.floor(Math.log2(this.value.naturalWidth/this.value.width));if(0===l)o.drawImage(e,0,0,r,i,0,0,this.value.width,this.value.height);else{for(var s=0;s<l;s+=1)a=(n=r>>1)/this.value.aspectRatio,0===s?o.drawImage(e,0,0,r,i,0,0,n,a):o.drawImage(t,0,0,r,i,0,0,n,a),r=n,i=a;o.drawImage(t,0,0,r,i,0,0,this.value.width,this.value.height)}return t}},{key:"ImageStyling",value:function(e,t,n,a,o,r){var i=this.value.x+n+r,l=this.value.y+n+o,s=this.value.width-2*n,c=s/this.value.aspectRatio;e.save(),e.beginPath(),e.moveTo(i+a,l),e.lineTo(i+s-a,l),e.quadraticCurveTo(i+s,l,i+s,l+a),e.lineTo(i+s,l+c-a),e.quadraticCurveTo(i+s,l+c,i+s-a,l+c),e.lineTo(i+a,l+c),e.quadraticCurveTo(i,l+c,i,l+c-a),e.lineTo(i,l+a),e.quadraticCurveTo(i,l,i+a,l),e.closePath(),e.clip(),e.drawImage(t,0,0,this.value.width,this.value.height,i,l,s,c),e.restore()}},{key:"CanvasDisplay",value:function(e,t,n,a,o){var r=this;if("cut"in this.value&&(this.left.CanvasDisplay(e,t,n,a,o),this.right.CanvasDisplay(e,t,n,a,o)),"title"in this.value){var i=e.getContext("2d"),l=new Image;l.onload=function(){var e=r.ResizeImage(l),s=e.getContext("2d");r.ImageStyling(i,e,t,n,a,o),s.clearRect(0,0,e.width,e.height)},l.src=this.value.src}}},{key:"generate",value:function(t,n,a){var o=t.map((function(e){return e.naturalWidth/e.naturalHeight}));if(a<1)return[];if(1===a){var i=h.Z.findClosest(o,n);return this.value=t[i],this.left=null,this.right=null,[].concat((0,g.Z)(t.slice(0,i)),(0,g.Z)(t.slice(i+1)))}var l,s,c=h.Z.getCut();if(this.value={cut:c,targetAspectRatio:n},2===a){var u=h.Z.findImgPair(o,n),d=(0,r.Z)(u,2),f=d[0],p=d[1];return this.value.aspectRatio=h.Z.getAspectRatio(this.value.cut,t[f].aspectRatio,t[p].aspectRatio),this.left=new e(t[f]),this.right=new e(t[p]),t.filter((function(e,t){return![f,p].includes(t)}))}this.left=new e({cut:h.Z.getCut()}),this.right=new e({cut:"v"===this.left.value.cut?"h":"v"}),s=n/2,"v"===c&&(s=2*n);var v=Math.round(Math.random())?["left","right"]:["right","left"],x=(0,r.Z)(v,2),m=x[0],Z=x[1];return l=this[m].generate(t,s,a-Math.floor(a/2)),l=this[Z].generate(l,s,Math.floor(a/2)),this.value.aspectRatio=h.Z.getAspectRatio(this.value.cut,this.left.value.aspectRatio,this.right.value.aspectRatio),l}},{key:"adjust",value:function(e){var t=0;return null===this||null!==this.left&&null!==this.right&&(this.value.aspectRatio>this.value.targetAspectRatio*e&&(this.value.cut="h",t+=1),this.value.aspectRatio<this.value.targetAspectRatio/e&&(this.value.cut="v",t+=1),"v"===this.value.cut?(this.left.value.targetAspectRatio=this.value.targetAspectRatio/2,this.right.value.targetAspectRatio=this.value.targetAspectRatio/2):(this.left.value.targetAspectRatio=2*this.value.targetAspectRatio,this.right.value.targetAspectRatio=2*this.value.targetAspectRatio),t+=this.left.adjust(e)+this.right.adjust(e),this.value.aspectRatio=h.Z.getAspectRatio(this.value.cut,this.left.value.aspectRatio,this.right.value.aspectRatio)),t}},{key:"addSize",value:function(e,t,n,a,o,r){"v"===o?(this.value.height=t,this.value.width=this.value.height*this.value.aspectRatio):(this.value.width=e,this.value.height=this.value.width/this.value.aspectRatio),"left"===r?(this.value.x=n,this.value.y=a):"h"===o?(this.value.y=a+t-this.value.height,this.value.x=n):(this.value.x=n+e-this.value.width,this.value.y=a),null!==this.left&&this.left.addSize(this.value.width,this.value.height,this.value.x,this.value.y,this.value.cut,"left"),null!==this.right&&this.right.addSize(this.value.width,this.value.height,this.value.x,this.value.y,this.value.cut,"right")}},{key:"validateAddSize",value:function(){if("cut"in this.value){var e=this.left.validateAddSize(),t=(0,r.Z)(e,2),n=t[0],a=t[1],o=this.right.validateAddSize(),i=(0,r.Z)(o,2),l=i[0],s=i[1];return[n&&l,a.concat(s)]}if("title"in this.value){var c=this.value.width<=this.value.naturalWidth&&this.value.height<=this.value.naturalHeight;return c?[c,[]]:[c,[(0,u.Z)({},this)]]}return!1}}]),e}(),I=function(){function e(t){if((0,v.Z)(this,e),void 0===this.root)return this.root=new R(t),this}return(0,x.Z)(e,[{key:"addOptions",value:function(e){this.root.options=(0,u.Z)({},e)}},{key:"display",value:function(){return null!==this.root?this.root.display():null}},{key:"replaceImages",value:function(e){null!==this.root&&this.root.replaceImages(e)}},{key:"fromObject",value:function(e){return null!=e.root&&this.root.fromObject(e.root),this}},{key:"removeImageData",value:function(){var e=this.copy();return null!==this.root&&e.root.removeImageData(),e}},{key:"addImageData",value:function(e){null!==this.root&&this.root.addImageData(e)}},{key:"DOMDisplay",value:function(e,t,n,a,o){var r=this.root.options,i=r.text,l=r.topText,s=r.padding,c=r.borderRadius,u=r.color,d=this.root.value,g=d.width,f=d.height,p=h.Z.wrapText(i,0,0,e,20,25),v=i.length?25*p.length:0,x=(t-v-f)/2,Z=(e-g)/2,b=t-v;return l&&i.length>0&&(x+=v,b=0),console.log("tree dom display",e,t,f,this.root.options,v,x,Z,g,this,p),null!==this.root?(0,C.jsx)(m.Z,{sx:{backgroundColor:"white"},children:(0,C.jsxs)(m.Z,{width:e,height:t,sx:{position:"relative",backgroundColor:h.Z.convertToRGBA(u)},children:[this.root.DOMDisplay(s,c,n,a,x,Z,o),i.length?j(p,b):null]})}):null}},{key:"CanvasDisplay",value:function(e,t,n,a){if(null!==this.root){var o=this.root.options,r=o.text,i=o.topText,l=o.padding,s=o.borderRadius,c=o.color,u=this.root.value,d=u.width,g=u.height,f=h.Z.wrapText(r,0,0,e,20*a,25*a),p=r.length?25*f.length*a:0,v=(t-p-g)/2,x=(e-d)/2,m=t-p;i&&r.length>0&&(v+=p,m=0);var Z=n.getContext("2d");Z.fillStyle=h.Z.convertToRGBA(c),Z.fillRect(0,0,n.width,n.height),this.root.CanvasDisplay(n,l*a,s*a,v,x),h.Z.textCanvasDraw(Z,f,m,a,e,p)}}},{key:"generateScore",value:function(){var e=this.root.getScore();return Math.min.apply(Math,(0,g.Z)(e))}},{key:"generateCollageTree",value:function(e,t){this.root.generate(e,t,e.length)}},{key:"adjust",value:function(e){for(var t=0,n=this.copy(),a=this.root.value.aspectRatio,o=this.root.value.targetAspectRatio*(1-e),r=1e3;t<100&&r>0;){r=this.root.adjust(e),t+=1;var i=this.root.value.aspectRatio-this.root.value.targetAspectRatio;if(Math.abs(i)<Math.abs(a-this.root.value.targetAspectRatio)&&(a=this.root.value.aspectRatio,n=this.copy()),i>0&&i<o||0===i)break}return[a,n]}},{key:"copy",value:function(){var t=new e({});return t.root=this.root.copy(),t.root.options=(0,u.Z)({},this.root.options),t}},{key:"addSize",value:function(e,t,n){var a=h.Z.getCollageDimension(e,t,n),o=(0,r.Z)(a,2),i=o[0],l=o[1];this.root.value.width=i,this.root.value.height=l,console.log("add size",this.root.value.width,this.root.value.height),this.root.value.x=0,this.root.value.y=0;var s=this.root.value,c=s.width,u=s.height,d=s.x,g=s.y,f=s.cut;null!==this.root.left&&this.root.left.addSize(c,u,d,g,f,"left"),null!==this.root.right&&this.root.right.addSize(c,u,d,g,f,"right")}},{key:"validateAddSize",value:function(){return this.root.validateAddSize()}}]),e}();var D={findBestAdjustTree:function(e,t,n,a){for(var o=e.sort((function(e,t){return e.aspectRatio<=t.aspectRatio?1:-1})),r=[],i=0;i<100;i+=1){var l=new I({cut:h.Z.getCut()});l.generateCollageTree(o,n/a),r.push(l.adjust(1-t))}r.sort((function(e,t){var o=n/a;return Math.abs(e[0]-o)-Math.abs(t[0]-o)}));var s=r.filter((function(e){return e[0].toFixed(1)===r[0][0].toFixed(1)}));console.log("from bar",s);var c=0,u={};return s.forEach((function(e){e[1].addSize(n/a*1e3,1e3,n/a);var t=e[1].generateScore();t>c&&(c=t,u=e)})),u}};var z=n(94606);function P(e){console.log("use base",e);var t=(0,l.useState)(e),n=(0,r.Z)(t,2),i=n[0],v=n[1],x=(0,l.useState)("Untitled"),m=(0,r.Z)(x,2),Z=m[0],b=m[1],C={tolerance:.1,resizeImageWidth:1500,aspectRatio:.7,fontSize:20,lineHeight:25,paperSizes:{A472:{width:595,height:842,text:"8 X 11 inches 72DPI"},A4:{width:2480,height:3508,text:"8 X 11 inches"},A3:{width:3508,height:4961,text:"11 X 16 inches"},A4LandScape:{height:2480,width:3508,text:"11 X 8 inches"},A3LandScape:{height:3508,width:4961,text:"16 X 11 inches"},FBCoverDesktop:{height:740,width:2e3,text:"FB Cover Desktop"},WhatsappStatus:{height:1920,width:1080,text:"Whatsapp Status"}}},j=(0,l.useState)(0),w=(0,r.Z)(j,2),y=w[0],k=w[1],S=function(e){var t=e.aspectRatio,n=e.fontSize,a=e.lineHeight,o=(0,l.useRef)(),i=(0,l.useRef)(),s=(0,l.useRef)(),c=(0,l.useRef)(),u=(0,l.useState)(0),d=(0,r.Z)(u,2),g=d[0],f=d[1],p=(0,l.useState)(0),v=(0,r.Z)(p,2),x=v[0],m=v[1],Z=(0,l.useState)(0),b=(0,r.Z)(Z,2),C=b[0],j=b[1],w=(0,l.useState)(0),y=(0,r.Z)(w,2),k=y[0],S=y[1],R=(0,l.useState)(0),I=(0,r.Z)(R,2),D=I[0],z=I[1],P=(0,l.useState)(0),W=(0,r.Z)(P,2),T=W[0],A=W[1],H=(0,l.useState)(0),O=(0,r.Z)(H,2),L=O[0],E=O[1],M=function(){if(!0===window.innerWidth<window.innerHeight){var e=(o.current?o.current.offsetHeight:0)+(i.current?i.current.offsetHeight:0)+(s.current?s.current.offsetHeight:0);A(window.innerWidth),z(window.innerHeight-e);var n=h.Z.getCollageDimension(window.innerWidth-10,window.innerHeight-e-10,t),a=(0,r.Z)(n,2),l=a[0],c=a[1];console.log("other height",e),S(l),f(c)}else{var u=o.current?o.current.offsetHeight:0,d=i.current?i.current.offsetWidth:0,g=s.current?s.current.offsetWidth:0;A(window.innerWidth-(g+d)),z(window.innerHeight-u);var p=h.Z.getCollageDimension(window.innerWidth-(g+d)-10,window.innerHeight-u-10,t),v=(0,r.Z)(p,2),x=v[0],m=v[1];console.log("other height",u,"other width",g+d,g,d,i),S(x),f(m)}};return(0,l.useEffect)((function(){console.log("dimensions changed"),M()}),[window.innerHeight,window.innerWidth,o.current,i.current,s.current]),(0,l.useEffect)((function(){return M(),window.addEventListener("resize",M),function(){return window.removeEventListener("resize",M)}}),[]),{addImageRef:c,actionsRef:i,headerRef:o,footerRef:s,width:k,height:g,imageHeight:x,imageWidth:C,setImageWidth:j,setImageHeight:m,maxHeight:D,maxWidth:T,handleImageAddClick:function(){c.current&&c.current.click()},textHeight:L,setTextHeight:E,fontSize:n,lineHeight:a}}(C),R=function(){var e={padding:2,borderRadius:5,color:{r:255,g:255,b:255,a:1},text:"",topText:!0},t=(0,l.useState)(e),n=(0,r.Z)(t,2),a=n[0],o=n[1],i=(0,l.useState)(!1),s=(0,r.Z)(i,2),c=s[0],h=s[1];return{options:a,setOptions:o,clear:function(){return o(e)},handlePaddingChange:function(e){return o((function(t){return(0,u.Z)((0,u.Z)({},t),{},{padding:e.target.value})}))},handleRadiusChange:function(e){o((function(t){return(0,u.Z)((0,u.Z)({},t),{},{borderRadius:e.target.value})}))},handleColorClick:function(){return h((function(e){return!e}))},handleColorClose:function(){return h(!1)},handleColorChange:function(e){return o((function(t){return(0,u.Z)((0,u.Z)({},t),{},{color:e.rgb})}))},handlePositionChange:function(e){return o((function(t){return(0,u.Z)((0,u.Z)({},t),{},{topText:e})}))},handleTextChange:function(e){var t=e.target;o((function(e){return(0,u.Z)((0,u.Z)({},e),{},{text:t.value})}))},displayColorPicker:c}}(),P=function(){var e=(0,l.useState)(!1),t=(0,r.Z)(e,2),n=t[0],a=t[1],o=(0,l.useState)(!1),i=(0,r.Z)(o,2),s=i[0],c=i[1],u=(0,l.useState)(!1),h=(0,r.Z)(u,2),d=h[0],g=h[1],f=(0,l.useState)(!1),p=(0,r.Z)(f,2),v=p[0],x=p[1],m=(0,l.useState)(!1),Z=(0,r.Z)(m,2),b=Z[0],C=Z[1],j=(0,l.useState)(!1),w=(0,r.Z)(j,2),y=w[0],k=w[1],S=(0,l.useState)({paperWidth:0,paperHeight:0}),R=(0,r.Z)(S,2),I=R[0],D=R[1];return{clearDelete:function(){return k(!1)},generate:b,handleDownload:function(){return a(!0)},handleGenerateCallback:function(){C(!1),D({paperWidth:0,paperHeight:0})},onDelete:function(){return k((function(e){return!e}))},onDownloadClick:function(e,t){D({paperWidth:e,paperHeight:t}),C(!0),a(!1)},onDownloadClose:function(){return a(!1)},onRefresh:function(){return x(!0)},open:n,printOptions:I,refresh:v,setGenerate:C,setOpen:a,setPrintOptions:D,setRefresh:x,removeImage:y,setRemoveImage:k,saveOpen:s,setSaveOpen:c,onSaveClose:function(){return c(!1)},onSaveClick:function(){g(!0),c(!1)},handleSave:function(){c(!0)},saveStart:d,setSaveStart:g}}(),W=function(e){console.log("use images",e);var t=(0,l.useState)(0),n=(0,r.Z)(t,2),i=n[0],c=n[1],u=(0,l.useState)(0),v=(0,r.Z)(u,2),x=v[0],m=v[1],Z=(0,l.useState)(0),b=(0,r.Z)(Z,2),C=b[0],j=b[1],w=(0,l.useState)(0),y=(0,r.Z)(w,2),k=y[0],S=y[1],R=(0,l.useState)([]),I=(0,r.Z)(R,2),D=I[0],z=I[1];(0,l.useEffect)((function(){console.log("setting images"),"images"in e&&(z(e.images),0===C&&j(e.images.length))}),[e]);var P=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z((function(e){return e.concat([t])})),m((function(e){return e+1})),e.next=4,s.Z.save([t],"images");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{clear:function(){z([]),j(0),S(0),m(0)},handleImageData:P,handleLoad:function(e){h.Z.handleImageLoad(e,j,c,P)},images:D,imgCount:C,loaded:k,newImagesLoaded:x,newImgCount:i,remove:function(e){var t=D.findIndex((function(t){return t.title===e}));s.Z.remove(D[t].title,"images");var n=[].concat((0,g.Z)(D.slice(0,t)),(0,g.Z)(D.slice(t+1)));return z(n),j((function(e){return e-1})),n},setImageCount:j,setImages:z,setLoaded:S,setNewImageCount:c,setNewImagesLoaded:m,getImageData:function(e){return(0,g.Z)(e).map((function(e){e.file,e.src,e.originalSRC;var t=e.originalWidth,n=e.originalHeight,a=(0,d.Z)(e,f);return a.naturalWidth=t,a.naturalHeight=n,console.log("get image data",e,a),a}))},removeImageData:function(e){return(0,g.Z)(e).map((function(e){e.file,e.src,e.originalSRC;var t=(0,d.Z)(e,p);return console.log("get image data",e,t),t}))}}}(i),T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};console.log("use Tree",e);var n=(0,l.useState)(new I({})),a=(0,r.Z)(n,2),o=a[0],i=a[1];(0,l.useEffect)((function(){console.log("use Tree useEffect");var n=new I({});"details"in e&&Object.keys(e.details).length>0&&(console.log("initial value in tree",e),n.fromObject(e.details.tree),"options"in e.details.tree.root&&t((function(t){return(0,u.Z)((0,u.Z)({},t),e.details.tree.root.options)})),console.log("setting tree"),i(n))}),[e]);var s=function(){return i({})},c=function(e,t,n,a,o){var l=D.findBestAdjustTree(e,t,n,a),s=(0,r.Z)(l,2)[1];s.addOptions(o),i(s)};return{tree:o,setTree:i,clear:s,reAdjust:c}}(i,R.setOptions),A=(0,l.useState)({}),H=(0,r.Z)(A,2),O=H[0],L=H[1],E="details"in e&&"collage_id"in e.details?e.details.collage_id:Date.now();(0,l.useEffect)((function(){v(e),"details"in e&&"name"in e.details&&"Untitled"===Z&&(console.log("setting collage name",e.details.name),b(e.details.name))}),[e]);var M=(0,l.useState)((function(){return{details:{text:"Saving Details",status:"pending"},images:{text:"Saving Images (".concat(y," / ").concat(W.images.length,")"),status:"pending"},finalizing:{text:"Finalizing Collage",status:"pending"}}})),F=(0,r.Z)(M,2),q=F[0],B=F[1],_=function(e,t){var n=(0,u.Z)((0,u.Z)({},q[e]),{},{status:t});B((function(t){return(0,u.Z)((0,u.Z)({},t),{},(0,c.Z)({},e,n))}))};(0,l.useEffect)((function(){console.log("useeffect 3"),function(){var e="Saving Images (".concat(y," / ").concat(W.imgCount,")"),t=(0,u.Z)((0,u.Z)({},q.images),{},{text:e});y===W.imgCount&&W.imgCount>0&&(t=(0,u.Z)((0,u.Z)({},t),{},{status:"done"})),B((function(e){return(0,u.Z)((0,u.Z)({},e),{},{images:t})}))}()}),[y,W.imgCount]);var U=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.allSettled([T.clear(),W.clear(),R.clear()]);case 2:t=e.sent,n=0;case 4:if(!(n<t.length)){e.next=10;break}if("fulfilled"!==t[n].status&&!0!==t[n].value.ok){e.next=7;break}return e.abrupt("return",!0);case 7:n+=1,e.next=4;break;case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){console.log("useeffect 2"),(W.newImgCount>0&&W.newImgCount===W.newImagesLoaded||P.refresh)&&(W.setNewImageCount(0),W.setNewImagesLoaded(0),T.reAdjust(W.images,C.tolerance,S.width,S.height-S.textHeight,R.options),P.setRefresh(!1))}),[W.newImgCount,W.newImagesLoaded,P.refresh]);var N=function(){var e=T.tree.root.value.aspectRatio,t=document.createElement("canvas"),n=T.tree.copy();n.addSize(500*e,500,e),t.width=500*e,t.height=500,n.CanvasDisplay(500*e,500,t,500*e/S.width);var a={title:"thumbnail-".concat(E,".png"),src:"",naturalHeight:500,naturalWidth:500*e,aspectRatio:e,type:"image/png"};return L(a),[a,t]},V=function(e,t){var n={collage_id:E.toString(),name:t,created_at:"2021-02-18T21:54:42.123Z",last_updated_at:"2021-02-18T21:54:45.123Z",images:W.getImageData(W.images),tree:T.tree.removeImageData(),thumbnail:e};return console.log(n),z.Z.newCollage(E,n)},G=function(e,t){var n=Object.keys(t).map(function(){var n=(0,o.Z)((0,a.Z)().mark((function n(r){var i,l,s,c,u;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i="thumbnail-".concat(E,".jpg"),r!==i){n.next=4;break}return l=e.toBlob(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L(n),e.abrupt("return",z.Z.upload(t[i],n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.abrupt("return",l);case 4:return s=t[r],c=W.images.find((function(e){return e.title===r})),n.next=8,z.Z.upload(s,c.file);case 8:return u=n.sent,console.log("Setting uploaded images to ",y+1),k((function(e){return e+1})),console.log("image upload resp",u),n.abrupt("return",u);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());return n},X=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,o,i,l,s,c,u,h,d,g;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T.tree.root.value.aspectRatio,console.log("in generate thumbnail",n,500*n,500),o=N(),i=(0,r.Z)(o,2),l=i[0],s=i[1],_("details","running"),e.next=6,V(l,t);case 6:return c=e.sent,_("details","done"),_("images","running"),u=G(s,c),e.next=12,Promise.allSettled(u);case 12:h=e.sent,_("finalizing","running"),g=0;case 15:if(!(g<h.length)){e.next=27;break}if("fulfilled"!==h[g].status&&!0!==h[g].value.ok){e.next=21;break}d=!0,_("finalizing","done"),e.next=24;break;case 21:return d=!1,_("finalizing","failed"),e.abrupt("break",27);case 24:g+=1,e.next=15;break;case 27:return e.abrupt("return",d);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){if(console.log("useeffect 1"),R.options.text.length>0&&Object.keys(T.tree).length>0){var e=h.Z.wrapText(R.options.text,0,0,S.width,20,25);S.setTextHeight(25*e.length);var t=h.Z.getCollageDimension(S.width,S.height-25*e.length,T.tree.root.value.aspectRatio),n=(0,r.Z)(t,2),a=n[0],o=n[1];S.setImageWidth(a),S.setImageHeight(o)}else S.setTextHeight(0),R.handlePositionChange(!0),S.setImageWidth(S.width),S.setImageHeight(S.height)}),[S.width,S.height,T.tree,R.options.text]);var J=function(e,t){return b(e),{collage_id:E.toString(),name:e,created_at:"2021-02-18T21:54:42.123Z",last_updated_at:"2021-02-18T21:54:45.123Z",images:W.getImageData(W.images),tree:T.tree.removeImageData(),thumbnail:t}},Y=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,o,i,l,s,c,u,h,d,g;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T.tree.root.value.aspectRatio,console.log("in generate thumbnail",n,500*n,500),o=N(),i=(0,r.Z)(o,2),l=i[0],s=i[1],_("details","running"),e.next=6,z.Z.saveCollage(E,J(t,l));case 6:return c=e.sent,console.log("save collage imageurls",c),_("details","done"),_("images","running"),u=G(s,c),e.next=13,Promise.allSettled(u);case 13:h=e.sent,_("finalizing","running"),g=0;case 16:if(!(g<h.length)){e.next=28;break}if("fulfilled"!==h[g].status&&!0!==h[g].value.ok){e.next=22;break}d=!0,_("finalizing","done"),e.next=25;break;case 22:return d=!1,_("finalizing","failed"),e.abrupt("break",28);case 25:g+=1,e.next=16;break;case 28:return e.abrupt("return",d);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return console.log("saveStatus",q),[J,Z,O,E,C,S,R,P,W,T,U,function(){},function(e){var t=W.remove(e);T.reAdjust(t,C.tolerance,S.imageWidth,S.imageHeight,R.options)},X,q,Y,function(e,t){return b(e),{collage_id:E.toString(),name:e,created_at:"2021-02-18T21:54:42.123Z",last_updated_at:"2021-02-18T21:54:45.123Z",images:W.removeImageData(W.images),tree:T.tree.removeImageData(),thumbnail:t}}]}var W=n(57689),T=n(5574),A=n(53767),H=n(13239),O=n(39157),L=n(76476);function E(e){var t=e.dimensionProps,n=e.imageProps,a=e.actionProps,o=e.collageCallback,i=e.handleRemoveImage,s=e.options,c=e.tree,u=(0,l.useState)(null),d=(0,r.Z)(u,2),g=d[0],f=d[1],p=n.images,v=n.setLoaded,x=a.generate,m=a.handleGenerateCallback,Z=a.printOptions,b=a.removeImage,C=t.height,j=t.width,w=t.imageHeight,y=t.imageWidth,k=t.fontSize,S=t.lineHeight,R=function(){return v((function(e){return e+1}))},I=function(e){return 0===Object.keys(e).length},D=function(){if(console.log("started collage loading",c),c.addSize(y,w,c.root.value.aspectRatio),console.log("collage added size"),c.addOptions(s),console.log("collage added options",p.length),p.length>0){c.addImageData(p),console.log("collage added image data");var e=c.DOMDisplay(j,C,b,i,R);console.log("collage added dom display"),f(e),o(c)}};(0,l.useEffect)((function(){I(c)||null==c.root.left||(console.log("collage, tree is not empty"),D())}),[]),(0,l.useEffect)((function(){I(c)||null==c.root.left?f(null):(console.log("collage, tree is not empty 1"),D())}),[c,s,y,w,b,p]);var z=function(e,t){var n=function(){var e=c.copy();return e.replaceImages(p),e}(),a=c.root.value.aspectRatio,o=e/j,i=h.Z.getImageDimensions(e,t,s.text,0,0,k,S,o,c.root.value.aspectRatio),l=(0,r.Z)(i,2),u=l[0],d=l[1];return n.addSize(u,d,a),n},P=function(e,t,n){var a=t/j,o=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}(t,n);e.CanvasDisplay(t,n,o,a),setTimeout((function(){return e=t,a=n,void o.toBlob((function(t){var n=document.createElement("a");n.download="collage-".concat(e.toFixed(2),"X").concat(a.toFixed(2),"-").concat(Date.now(),".jpg"),n.href=URL.createObjectURL(t),n.click(),URL.revokeObjectURL(n.href),n.href=null,m()}),"image/jpeg");var e,a}),"5000")};return(0,l.useEffect)((function(){if(!0===x){var e=Z.paperWidth,t=Z.paperHeight,n=z(e,t),a=n.validateAddSize(),o=(0,r.Z)(a,2),i=o[0],l=o[1];if(i)P(n,e,t);else{var s=h.Z.optimizeDimensions(e,t,l),c=(0,r.Z)(s,2),u=c[0],d=c[1],g=z(u,d),f=g.validateAddSize(),p=(0,r.Z)(f,2),v=p[0],m=p[1];v?P(g,u,d):console.log("unable to generate collage",m)}}}),[x]),g}var M=n(36151),F=n(65661),q=n(97123),B=n(51691),_=n(23786),U=n(99321),N=n(94925),V=n(68096);function G(e){var t=e.open,n=e.onClick,a=e.onClose,o=e.sizes,i=(0,l.useState)(""),s=(0,r.Z)(i,2),c=s[0],u=s[1];return(0,C.jsx)(L.Z,{children:(0,C.jsxs)(T.Z,{open:t,fullWidth:!0,children:[(0,C.jsx)(F.Z,{sx:{textAlign:"center"},children:"Download Collage"}),(0,C.jsxs)(O.Z,{dividers:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,C.jsx)(B.Z,{sx:{display:"inline",pr:1},children:"Choose collage size"}),(0,C.jsxs)(V.Z,{fullWidth:!0,sx:{maxWidth:"60%"},children:[(0,C.jsx)(N.Z,{id:"demo-simple-select-label",children:"Download Size"}),(0,C.jsx)(U.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",defaultValue:"A4",value:c,label:"Download Size",onChange:function(e){return u(e.target.value)},children:Object.keys(o).map((function(e){return(0,C.jsx)(_.Z,{value:e,children:o[e].text},o[e].text)}))})]})]}),(0,C.jsxs)(q.Z,{children:[(0,C.jsx)(M.Z,{variant:"outlined",disabled:0===c.length,onClick:function(){console.log(o[c].width,o[c].height,n),n(o[c].width,o[c].height),u("")},children:"Download"}),(0,C.jsx)(M.Z,{variant:"text",onClick:function(){u(""),a()},children:"Cancel"})]})]})})}var X=n(27391);function J(e){var t=e.open,n=e.onClick,a=e.onClose,o=(0,l.useState)(""),i=(0,r.Z)(o,2),s=i[0],c=i[1],u=(0,l.useState)(""),h=(0,r.Z)(u,1)[0];return(0,C.jsxs)(T.Z,{open:t,fullWidth:!0,children:[(0,C.jsx)(F.Z,{sx:{textAlign:"center"},children:"Save Collage"}),(0,C.jsx)(O.Z,{dividers:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:(0,C.jsx)(X.Z,{variant:"outlined",label:"Set Collage Name",defaultValue:s,onChange:function(e){var t=e.target;c(t.value)},size:"small",sx:{width:"100%",mb:1},InputProps:{sx:{backgroundColor:(0,b.Fq)("#fff",.9)}},helperText:h,error:!!h})}),(0,C.jsxs)(q.Z,{children:[(0,C.jsx)(M.Z,{variant:"outlined",disabled:0===s.length,onClick:function(){n(s)},children:"Save"}),(0,C.jsx)(M.Z,{variant:"text",onClick:function(){c(""),a()},children:"Cancel"})]})]})}var Y=n(3155),K=n(98946),Q=n(29823);function $(e){var t=e.status;return"running"===t?(0,C.jsx)(H.Z,{color:"info",size:"1rem"}):"pending"===t?(0,C.jsx)(Y.Z,{color:"disabled",size:"0.875rem"}):"done"===t?(0,C.jsx)(K.Z,{color:"success",size:"0.875rem"}):"failed"===t?(0,C.jsx)(Q.Z,{color:"error",size:"0.875rem"}):void 0}function ee(e){var t=e.text,n=e.status,a={pending:(0,b.Fq)("#000",.26),done:"black",running:"black",failed:"red"};return(0,C.jsxs)(A.Z,{direction:"row",justifyContent:"space-between",children:[(0,C.jsx)(Z.Z,{sx:{fontWeight:"bold",fontSize:"1rem",color:a[n]},children:t}),(0,C.jsx)($,{status:n})]})}function te(e){var t=e.status,n=e.counter;return"failed"===t?(0,C.jsxs)(A.Z,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{width:"100%",p:1},children:[(0,C.jsx)(Q.Z,{color:"error"}),(0,C.jsx)(Z.Z,{children:"Collage creation failed"})]}):"running"===t||"pending"===t?null:"success"===t?(0,C.jsxs)(A.Z,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",sx:{width:"100%",p:1},children:[(0,C.jsx)(K.Z,{color:"success",sx:{fontSize:"2rem"}}),(0,C.jsxs)(Z.Z,{children:["Collage creation successful. Navigation to collages in ",n," ","seconds..."]})]}):null}function ne(e){var t=e.open,n=e.status,a="pending",o=(0,l.useState)(-1),i=(0,r.Z)(o,2),s=i[0],c=i[1];(0,l.useEffect)((function(){var e;return s>0&&"success"===a&&(e=setTimeout((function(){return c(s-1)}),1e3)),function(){return clearTimeout(e)}}),[s,a]);var u=Object.values(n).map((function(e){return e.status}));return u.includes("failed")?a="failed":u.includes("running")?a="running":u.includes("pending")||(console.log("setting counter",s,n),-1===s&&c(3),a="success"),(0,C.jsxs)(T.Z,{open:t,fullWidth:!0,children:[(0,C.jsx)(F.Z,{sx:{textAlign:"center"},children:"Save Collage"}),(0,C.jsx)(O.Z,{dividers:!0,children:(0,C.jsx)(A.Z,{direction:"column",justifyContent:"center",spacing:2,children:Object.values(n).map((function(e){return(0,C.jsx)(ee,{text:e.text,status:e.status},e.text)}))})}),(0,C.jsx)(te,{status:a,counter:s})]})}var ae=n(35527),oe=n(50533),re=n(67394),ie=n(9052),le=n(36194),se=n(18253);function ce(e){var t=e.headerRef,n=e.name,a=e.handlePreLogin;console.log("in collage header",n);var o=""!==ie.Z.getUserInfo();return(0,C.jsxs)(ae.Z,{ref:t,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,backgroundColor:(0,b.Fq)("#fff",.1),borderRadius:0},elevation:3,children:[(0,C.jsx)(m.Z,{sx:{postion:"absolute",left:"5px"},children:(0,C.jsx)(oe.Z,{href:"/collages",color:"muted.main",underline:"none",children:(0,C.jsx)(m.Z,{sx:{display:"flex",alignItems:"center"},children:(0,C.jsx)(re.Z,{})})})}),(0,C.jsx)(Z.Z,{variant:"h4",component:"h4",sx:{color:(0,b.Fq)("#fff",.5)},children:n}),!0===o?(0,C.jsx)(le.Z,{}):(0,C.jsx)(se.Z,{authURL:"authbridge-stage.mymemorystore.in",next:"collage/create",handlePreLogin:a})]})}var ue=n(28257),he=n(7690);function de(e){var t=e.width,n=e.height,a=e.loadComponent;return console.log(t,n),(0,C.jsx)(m.Z,{sx:{backgroundImage:"url(".concat(he,")"),backgroundSize:t,objectFit:"fill",width:t,height:n,display:"flex",justifyContent:"center",alignItems:"center"},children:a})}var ge=n(44768);function fe(e){var t,n=e.open,a=e.saveOpen,o=e.saveStatusOpen,r=e.status,i=e.dimensionProps,l=e.imageProps,s=e.header,c=e.actions,u=e.downloadDialog,h=e.saveDialog,d=e.saveStatusDialog,g=e.collage,f=e.controls,p=e.saveType,v=i.width,x=i.height,Z=i.maxWidth,b=i.maxHeight,j=i.imageHeight,w=i.headerRef,y=i.actionsRef,k=window.innerWidth<window.innerHeight,S=l.images,R=l.imgCount,I=l.handleLoad,D=w.current?w.current.offsetHeight:0,z=y.current?y.current.offsetHeight:0,P=k?"calc(50% + ".concat(D," + ").concat(z,")"):"calc(50 % + ".concat(D,")");return console.log("from view",S.length,R,j,g,r),"fetching"===r&&(t=(0,C.jsx)(de,{width:v,height:x,loadComponent:(0,C.jsx)(ue.Z,{title:"Fetching existing collage data ..."})})),"preparing"===r&&(t=(0,C.jsxs)(C.Fragment,{children:[g,(0,C.jsx)(ue.Z,{title:"Preparing collage..."})]})),"loading"===r&&(t=(0,C.jsx)(de,{width:v,height:x,loadComponent:(0,C.jsx)(ue.Z,{title:"Loading (".concat(S.length," / ").concat(R,") images...")})})),"empty"===r&&(t=(0,C.jsx)(de,{width:v,height:x,loadComponent:v?(0,C.jsx)(ge.Z,{handleChange:I}):(0,C.jsx)("div",{})})),"ready"===r&&(t=g),"new"===p?(0,C.jsxs)(m.Z,{component:"div",sx:{backgroundColor:"black",position:"relative"},children:[s,c,n?u:null,a?h:null,o?d:null,(0,C.jsx)(m.Z,{width:Z,height:b,sx:{position:"absolute",top:P,left:"50%",transform:"translate(-50%, 0)",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",justifySelf:"center"},children:t}),f]}):(0,C.jsxs)(m.Z,{component:"div",sx:{backgroundColor:"black"},children:[s,(0,C.jsxs)(L.Z,{children:[c,n?u:null,a?h:null,o?d:null,(0,C.jsx)(m.Z,{width:Z,height:b,sx:{position:"absolute",top:P,left:"50%",transform:"translate(-50%, 0)",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"black",justifySelf:"center"},children:t}),f]})]})}var pe=n(53329),ve=n(73518),xe=n(88014),me=n(90493),Ze=n(59646);function be(e){var t=e.label,n=e.icon,a=e.handleChange;return(0,C.jsx)(Ze.Z,{showLabel:!0,label:t,icon:n,sx:{py:1,fontWeight:"bold",color:"gray",outline:"none","&:focus":{color:(0,b.Fq)("#fff",.8),outline:"none"}},onClick:a})}be.defaultProps={handleChange:function(){}};var Ce=n(9953);function je(e){var t=e.anchor,n=e.children,a=e.innerRef;return(0,C.jsx)(Ce.ZP,{anchor:t,variant:"permanent",PaperProps:{ref:a,sx:{height:"fit-content",top:"50%",backgroundColor:"transparent",color:"gray",fontWeight:"bold",borderRadius:"left"===t?"0 10px 10px 0":"10px 0 0 10px",transform:"translate(0, -50%)"}},children:n})}je.defaultProps={innerRef:function(){}};var we=n(94721);function ye(){return(0,C.jsx)(we.Z,{sx:{backgroundColor:"gray",my:1},variant:"middle"})}function ke(e){var t=e.actionsRef,n=e.onDownload,a=e.onSave,o=function(e){console.log(e),"download"===e&&n(),"save"===e?a():console.log("functionality for ",e,"not yet implemented")};return(0,C.jsx)(je,{anchor:"right",innerRef:t,children:(0,C.jsxs)(me.Z,{sx:{backgroundColor:(0,b.Fq)("#fff",.1)},children:[(0,C.jsx)(be,{label:"Save",icon:(0,C.jsx)(pe.Z,{}),handleChange:function(){return o("save")}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:"Download",icon:(0,C.jsx)(ve.Z,{}),handleChange:function(){return o("download")}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(Z.Z,{sx:{fontSize:"0.75rem",fontWeight:"bold"},children:"Order"}),(0,C.jsx)(Z.Z,{sx:{fontSize:"0.75rem",fontWeight:"bold"},children:"Print(s)"})]}),icon:(0,C.jsx)(xe.Z,{}),handleChange:function(){return o("print")}})]})})}var Se=n(43950),Re=n(41286),Ie=n(85399),De=n(84275);function ze(e){var t=e.open,n=e.onSubmit,a=e.onCancel;return(0,C.jsxs)(T.Z,{open:t,children:[(0,C.jsx)(F.Z,{sx:{textAlign:"center",fontWeight:"bold",color:(0,b.Fq)("#000",.8)},children:"Clear Collage"}),(0,C.jsxs)(O.Z,{dividers:!0,children:[(0,C.jsx)(B.Z,{sx:{fontWeight:"bold",color:"gray"},children:"Do you want to clear collage?"}),(0,C.jsx)(Z.Z,{variant:"subtitle2",sx:{color:"red",fontWeight:"bold"},noWrap:!0,children:"Note:"}),(0,C.jsx)(Z.Z,{sx:{fontSize:"0.8rem",color:"gray"},children:"This change is not reversible"})]}),(0,C.jsxs)(q.Z,{children:[(0,C.jsxs)(M.Z,{onClick:n,sx:{color:"red"},children:[" ","Clear"," "]}),(0,C.jsxs)(M.Z,{variant:"outlined",onClick:a,children:[" ","Cancel"," "]})]})]})}function Pe(e){var t=e.innerRef,n=e.onRefresh,a=e.photosComp,o=e.editComp,i=e.handleClear,s=e.clearDelete,c=(0,l.useState)(!1),u=(0,r.Z)(c,2),h=u[0],d=u[1],g=(0,l.useState)(!1),f=(0,r.Z)(g,2),p=f[0],v=f[1],x=(0,l.useState)(!1),m=(0,r.Z)(x,2),Z=m[0],j=m[1],w=function(){s(),d(!1),v(!1),j(!1)},y=function(){return j(!1)};return console.log("clear open",Z),console.log("rendering desktop controls"),(0,C.jsx)(je,{anchor:"left",children:(0,C.jsxs)(A.Z,{direction:"row",spacing:2,alignItems:"center",ref:t,children:[(0,C.jsxs)(me.Z,{sx:{backgroundColor:(0,b.Fq)("#fff",.1),borderRadius:"0 10px 10px 0"},children:[(0,C.jsx)(be,{label:"Rearrange",icon:(0,C.jsx)(De.Z,{}),handleChange:function(){w(),n()}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:"Photos",icon:(0,C.jsx)(Ie.Z,{}),handleChange:function(){h?d(!1):(w(),d(!0))}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:"Edit",icon:(0,C.jsx)(Re.Z,{}),handleChange:function(){p?v(!1):(w(),v(!0))}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:"Clear",icon:(0,C.jsx)(Se.Z,{}),handleChange:function(){console.log("clear open",Z),Z?j(!1):(w(),j(!0))}})]}),h?a:null,p?o:null,(0,C.jsx)(ze,{open:Z,onSubmit:function(){y(),i()},onCancel:y})]})})}var We=n(32913);function Te(e){var t=e.onDelete,n=e.onAdd,a=e.clearDelete;return(0,C.jsxs)(me.Z,{sx:{backgroundColor:(0,b.Fq)("#fff",.15),borderRadius:"10px 10px 10px 10px",height:"fit-content"},children:[(0,C.jsx)(be,{label:"Add",icon:(0,C.jsx)(We.Z,{}),handleChange:function(){a(),n()}}),(0,C.jsx)(ye,{}),(0,C.jsx)(be,{label:"Delete",icon:(0,C.jsx)(y.Z,{}),handleChange:t})]})}var Ae=n(10889);function He(e){var t=e.padding,n=e.handlePaddingChange;return(0,C.jsxs)(A.Z,{direction:"column",justifyContent:"center",alignItems:"start",sx:{backgroundColor:"transparent"},children:[(0,C.jsx)(Z.Z,{sx:{fontWeight:"bold",color:"gray",fontSize:"0.87rem",mixBlendMode:"difference"},children:"Padding"}),(0,C.jsx)(Ae.ZP,{"aria-label":"Padding",defaultValue:0,value:t,valueLabelDisplay:"auto",step:.1,min:0,max:10,onChange:n,sx:{color:"white"}})]})}function Oe(e){var t=e.radius,n=e.handleRadiusChange;return(0,C.jsxs)(A.Z,{direction:"column",justifyContent:"center",alignItems:"start",sx:{backgroundColor:"transparent"},children:[(0,C.jsx)(Z.Z,{sx:{fontWeight:"bold",color:"gray",fontSize:"0.87rem"},children:"Corner Radius"}),(0,C.jsx)(Ae.ZP,{"aria-label":"Corner Radius",defaultValue:0,value:t,valueLabelDisplay:"auto",step:1,min:0,max:40,onChange:n,sx:{color:"white"}})]})}var Le=n(63108);function Ee(e){var t=e.color,n=e.displayColorPicker,a=e.handleClick,o=e.handleClose,r=e.handleChange;return console.log("color control",t,n),(0,C.jsxs)(A.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,sx:{my:2},children:[(0,C.jsx)(Z.Z,{sx:{fontWeight:"bold",color:"gray",fontSize:"0.87rem"},children:"Background Color"}),(0,C.jsx)(m.Z,{component:"div",sx:{padding:"2px",background:"#fff",borderRadius:"5px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},onClick:a,children:(0,C.jsx)(m.Z,{component:"div",sx:{width:"70px",height:"30px",borderRadius:"18px",background:"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}})}),(0,C.jsx)(Me,{open:n,color:t,handleClose:o,handleChange:r})]})}function Me(e){var t=e.open,n=e.color,a=e.handleClose,o=e.handleChange;return console.log(a),t?(0,C.jsx)(C.Fragment,{children:(0,C.jsxs)(m.Z,{component:"div",sx:{position:"absolute",zIndex:3,bottom:10},children:[(0,C.jsx)(w.Z,{sx:{position:"absolute",top:0,right:0,zIndex:2,backgroundColor:"button.main",p:0,transform:"translate(0, -110%)",border:"2px solid black"},onClick:a,children:(0,C.jsx)(Q.Z,{})}),(0,C.jsx)(Le.AI,{color:n,onChange:o})]})}):null}var Fe=n(79012),qe=n(85523),Be=n(94454);function _e(e){var t=e.text,n=e.handleTextChange,a=e.topText,o=e.handlePositionChange,i=(0,l.useState)(""),s=(0,r.Z)(i,1)[0];return(0,C.jsxs)(A.Z,{sx:{backgroundColor:"transparent"},children:[(0,C.jsxs)(A.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[(0,C.jsx)(Z.Z,{sx:{fontWeight:"bold",color:"gray",fontSize:"0.87rem"},children:"Collage Text"}),(0,C.jsxs)(Fe.Z,{row:!0,children:[(0,C.jsx)(qe.Z,{disableTypography:!0,control:(0,C.jsx)(Be.Z,{size:"small",checked:!1===a,onChange:function(){return o(!1)},sx:{color:"white","&.Mui-checked":{color:"white"}}}),label:(0,C.jsx)(Z.Z,{fontSize:"0.8rem",fontWeight:"bold",children:"Bottom"}),sx:{color:"gray",fontWeight:"bold"}}),(0,C.jsx)(qe.Z,{disableTypography:!0,control:(0,C.jsx)(Be.Z,{size:"small",checked:!0===a,onChange:function(){return o(!0)},sx:{color:"gray","&.Mui-checked":{color:"white"}}}),label:(0,C.jsx)(Z.Z,{fontSize:"0.8rem",fontWeight:"bold",children:"Top"}),sx:{color:"gray",fontWeight:"bold",fontSize:"0.8rem"}})]})]}),(0,C.jsx)(X.Z,{variant:"outlined",label:"",defaultValue:t,onChange:n,size:"small",sx:{width:"100%",mb:1},InputProps:{sx:{backgroundColor:(0,b.Fq)("#fff",.9)}},helperText:(0,C.jsx)(Z.Z,{sx:{color:"gray",fontSize:"0.75rem"},children:s}),error:!!s})]})}function Ue(e){var t=e.optionProps,n=t.options,a=t.handlePaddingChange,o=t.displayColorPicker,r=t.handleColorChange,i=t.handleColorClose,l=t.handleColorClick,s=t.handleRadiusChange,c=t.handleTextChange,u=t.handlePositionChange;return(0,C.jsxs)(A.Z,{direction:"column",spacing:4,sx:{p:2,backgroundColor:(0,b.Fq)("#000",.7),borderRadius:"10px 10px 10px 10px",boxShadow:"0 0 10px inset rgba(255, 255, 255, 0.3)"},children:[(0,C.jsx)(He,{padding:n.padding,handlePaddingChange:a}),(0,C.jsx)(Oe,{radius:n.borderRadius,handleRadiusChange:s}),(0,C.jsx)(Ee,{color:n.color,displayColorPicker:o,handleChange:r,handleClose:i,handleClick:l}),(0,C.jsx)(_e,{text:n.text,topText:n.topText,handleTextChange:c,handlePositionChange:u})]})}var Ne=n(77849);function Ve(e){var t=e.label,n=e.icon,a=e.handleChange;return(0,C.jsx)(Ze.Z,{showLabel:!0,label:t,value:t.toLowerCase(),icon:n,sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}},onClick:a})}function Ge(e){var t=e.actionsRef,n=e.onDownload,a=e.onSave;return(0,C.jsxs)(Ne.Z,{ref:t,showLabels:!0,sx:{py:1,fontWeight:"bold",backgroundColor:(0,b.Fq)("#fff",.2)},children:[(0,C.jsx)(Ve,{label:"Save",icon:(0,C.jsx)(pe.Z,{}),handleChange:a}),(0,C.jsx)(Ve,{label:"Download",icon:(0,C.jsx)(ve.Z,{}),handleChange:n}),(0,C.jsx)(Ve,{label:"Print",icon:(0,C.jsx)(xe.Z,{}),handleChange:function(){}})]})}function Xe(e){var t=e.value,n=e.handleChange;return(0,C.jsxs)(Ne.Z,{showLabels:!0,value:t,onChange:n,sx:{fontWeight:"bold",backgroundColor:(0,b.Fq)("#fff",.2),"&.Mui-selected":{color:"white"}},children:[(0,C.jsx)(Ze.Z,{label:"Rearrange",value:"rearrange",icon:(0,C.jsx)(De.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:"Photos",value:"photo",icon:(0,C.jsx)(Ie.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:"Edit",value:"edit",icon:(0,C.jsx)(Re.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:"Clear",value:"clear",icon:(0,C.jsx)(Se.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}})]})}var Je=n(51907),Ye=n(3142),Ke=n(64483),Qe=n(61223);function $e(e){var t=e.color,n=e.editOptionsValue,a=e.open,o=e.handleOptionsClose,r=e.handleEditOptionsClick;return a?(0,C.jsxs)(m.Z,{sx:{position:"relative"},children:[(0,C.jsxs)(Ne.Z,{showLabels:!0,value:n,onChange:r,sx:{display:"flex",fontWeight:"bold",backgroundColor:(0,b.Fq)("#fff",.2),borderTop:"1px solid gray",position:"relative",alignItems:"center"},children:[(0,C.jsx)(Ze.Z,{label:(0,C.jsx)(Z.Z,{fontSize:"0.70rem",fontWeight:"bold",children:"Padding"}),value:"padding",icon:(0,C.jsx)(Je.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:(0,C.jsx)(Z.Z,{fontSize:"0.70rem",fontWeight:"bold",children:"Corner"}),value:"border radius",icon:(0,C.jsx)(Ye.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:(0,C.jsx)(Z.Z,{fontSize:"0.70rem",fontWeight:"bold",children:"Color"}),value:"color",icon:(0,C.jsx)(Ke.Z,{sx:{fill:"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")"),borderRadius:"5px"}}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}}),(0,C.jsx)(Ze.Z,{label:"Text",value:"text",icon:(0,C.jsx)(Qe.Z,{}),sx:{fontWeight:"bold",color:"gray","&.Mui-selected":{color:"white",outline:"none"}}})]}),(0,C.jsx)(Q.Z,{fontSize:"1rem",sx:{position:"absolute",top:5,right:5,fill:"white",backgroundColor:"gray",borderRadius:"50%",padding:"2px"},onClick:o})]}):null}function et(e){var t=e.open,n=e.value,a=e.handleOptionsClose,o=e.handleDelete,r=e.handleAdd;return t?(0,C.jsxs)(m.Z,{sx:{position:"relative"},children:[(0,C.jsxs)(Ne.Z,{showLabels:!0,value:n,sx:{fontWeight:"bold",backgroundColor:(0,b.Fq)("#fff",.2),borderTop:"1px solid gray","&.Mui-selected":{color:"white"}},children:[(0,C.jsx)(Ve,{label:"Delete",icon:(0,C.jsx)(y.Z,{}),handleChange:o}),(0,C.jsx)(Ve,{label:"Add",icon:(0,C.jsx)(We.Z,{}),handleChange:r})]}),(0,C.jsx)(Q.Z,{fontSize:"1rem",sx:{position:"absolute",top:5,right:5,fill:"white",backgroundColor:"gray",borderRadius:"50%",padding:"2px"},onClick:a})]}):null}function tt(e){var t=e.optionProps,n=e.actionProps,a=e.dimensionProps,o=e.handleClear,i=t.options,s=t.handlePaddingChange,c=t.handleRadiusChange,u=t.handleColorClose,h=t.handleColorClick,d=t.handleColorChange,g=t.handleTextChange,f=t.handlePositionChange,p=t.displayColorPicker,v=n.onRefresh,x=n.onDelete,j=n.clearDelete,w=a.footerRef,y=a.handleImageAddClick,k=(0,l.useState)(!0),S=(0,r.Z)(k,2),R=S[0],I=S[1],D=(0,l.useState)(""),z=(0,r.Z)(D,2),P=z[0],W=z[1],T=(0,l.useState)(!1),A=(0,r.Z)(T,2),H=A[0],O=A[1],L=(0,l.useState)(!1),E=(0,r.Z)(L,2),M=E[0],F=E[1],q=(0,l.useState)(null),B=(0,r.Z)(q,2),_=B[0],U=B[1],N=(0,l.useState)(""),V=(0,r.Z)(N,2),G=V[0],X=V[1],J=(0,l.useState)(!1),Y=(0,r.Z)(J,2),K=Y[0],Q=Y[1],$=(0,l.useState)(""),ee=(0,r.Z)($,2),te=ee[0],ne=ee[1],oe=function(){O(!1),U(null),X(""),I(!0),W("")};(0,l.useEffect)((function(){H&&"padding"===G&&U((0,C.jsx)(He,{padding:i.padding,handlePaddingChange:s}))}),[i.padding,H]),(0,l.useEffect)((function(){H&&"border radius"===G&&U((0,C.jsx)(Oe,{radius:i.borderRadius,handleRadiusChange:c}))}),[i.borderRadius,H]),(0,l.useEffect)((function(){H&&"color"===G&&U((0,C.jsx)(Me,{open:p,color:i.color,handleChange:d,handleClose:u}))}),[i.color,H,p]),(0,l.useEffect)((function(){console.log("text control useEffect"),H&&"text"===G&&U((0,C.jsx)(_e,{text:i.text,handleTextChange:g,topText:i.topText,handlePositionChange:f}))}),[i.text,H,i.topText]);return console.log("rerendering",_),(0,C.jsxs)(ae.Z,{ref:w,sx:{position:"fixed",bottom:0,left:0,right:0,mt:1,backgroundColor:"black",borderRadius:0},elevation:4,children:[(0,C.jsx)(ze,{open:M,onSubmit:function(){o(),F(!1),W("")},onCancel:function(){F(!1),W("")}}),_?(0,C.jsx)(m.Z,{sx:{backgroundColor:(0,b.Fq)("#fff",.15),p:1},children:_}):null,(0,C.jsx)(et,{open:K,value:te,handleDelete:x,handleAdd:function(){j(),y()},handleOptionsClose:function(){Q(!1),ne(""),I(!0),j(),W("")}}),(0,C.jsx)($e,{color:i.color,editOptionsValue:G,open:H,handleOptionsClose:oe,handleEditOptionsClick:function(e,t){console.log("handle edit options click"),X(t),"padding"===t?U((0,C.jsx)(He,{padding:i.padding,handlePaddingChange:s})):"border radius"===t?U((0,C.jsx)(Oe,{radius:i.borderRadius,handleRadiusChange:c})):"color"===t?(h(),U((0,C.jsx)(Me,{open:p,color:i.color,handleChange:d,handleClose:function(){U(null),u()}}))):"text"===t?(console.log(t),U((0,C.jsx)(_e,{text:i.text,handleTextChange:g,topText:i.topText,handlePositionChange:f}))):U((0,C.jsx)(Z.Z,{color:"secondary",children:t}))}}),R?(0,C.jsx)(Xe,{value:P,handleChange:function(e,t){j(),ne(""),Q(!1),I(!0),oe(),W(t),"rearrange"===t?v():"photo"===t?(I(!1),Q(!0)):"edit"===t?(I(!1),O(!0)):"clear"===t?F(!0):console.log("functionality for ",t,"not yet implemented")}}):null]})}function nt(e){var t=e.open;return console.log("save dialog",t),(0,C.jsx)(T.Z,{open:t,children:(0,C.jsx)(O.Z,{sx:{alignItems:"center"},children:(0,C.jsxs)(A.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:4,children:[(0,C.jsx)(H.Z,{sx:{mr:2}}),"Saving your work locally"]})})})}function at(e){var t=e.children,n=e.handleSave,i=(0,l.useState)(!1),s=(0,r.Z)(i,2),c=s[0],u=s[1],h=(0,l.useState)(!0),d=(0,r.Z)(h,2),g=d[0],f=d[1];return console.log("save locally",g,c),(0,l.useEffect)((function(){var e=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:u(!0),f(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),c?c?t:void 0:(0,C.jsx)(nt,{open:g})}function ot(e){var t=e.getCollage,n=e.clearCollage,c=e.saveType;console.log("base collage",c);var u=(0,W.s0)(),h=(0,l.useState)({}),d=(0,r.Z)(h,2),g=d[0],f=d[1],p=(0,l.useState)("fetching"),v=(0,r.Z)(p,2),x=v[0],b=v[1],j=(0,l.useState)(!1),w=(0,r.Z)(j,2),y=w[0],k=w[1],S=(0,l.useState)(""),R=(0,r.Z)(S,2),I=R[0],D=R[1],z=function(e){console.log("opening common dialog with message",e),""!==e&&(D(e),k(!0))},M=function(){console.log("closing common dialog",I),k(!1),D("")},F=P(g),q=(0,r.Z)(F,17),B=q[0],_=q[1],U=q[3],N=q[4],V=q[5],X=q[6],Y=q[7],K=q[8],Q=q[9],$=q[10],ee=q[11],te=q[12],ae=q[13],oe=q[14],re=q[15],ie=q[16];(0,l.useEffect)((0,o.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Object.keys(g).length){e.next=15;break}if(b("fetching"),"new"!==c){e.next=8;break}return e.next=5,t();case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,t(K.setImageCount,K.setNewImageCount,K.handleImageData);case 10:e.t0=e.sent;case 11:n=e.t0,b("fetch end"),console.log("setting collage details",n),f(n);case 15:case"end":return e.stop()}}),e)}))),[]),console.log("base collage",g,K.imgCount,K.loaded,K.images,K.newImagesLoaded,_,U),(0,l.useEffect)((function(){var e=x;0===K.imgCount&&0===Object.keys(g).length&&"fetch end"===e&&(e="empty"),K.images.length>0&&K.images.length===K.imgCount&&(e="preparing"),K.images.length<K.imgCount&&(e="loading"),K.loaded>=K.imgCount&&K.imgCount>0&&(e="ready"),b(e),console.log("status calculation",K.loaded,K.imgCount,K.images.length,e,g)}),[K]);var le=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z("Deleting Collage"),f({}),$(),e.next=5,n();case 5:b("fetch end"),M(),"existing"===c&&(z("Navigating to collages page"),setTimeout((function(){M(),u("/collages")}),3e3));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("in handle save",B(t),K.images),Y.onSaveClick(),"new"!==c){e.next=8;break}return e.next=5,ae(t);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,re(t);case 10:e.t0=e.sent;case 11:n=e.t0,console.log("save results",n,U),n&&setTimeout((function(){"new"===c&&le(),Y.setSaveStart(!1),u("/collages")}),3e3);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.Z.collageDB.details.clear();case 2:return e.next=4,s.Z.save([ie(_,{})],"details");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=(0,C.jsx)(at,{handleSave:he,children:(0,C.jsx)(G,{open:Y.open,onClick:Y.onDownloadClick,onClose:Y.onDownloadClose,sizes:N.paperSizes})}),ge=(0,C.jsx)(at,{handleSave:he,children:(0,C.jsx)(L.Z,{children:(0,C.jsx)(J,{open:Y.saveOpen,onClick:se,onClose:Y.onSaveClose})})}),pe=(0,C.jsx)(L.Z,{children:(0,C.jsx)(ne,{open:Y.saveStart,status:oe})}),ve=(0,C.jsx)(E,{dimensionProps:V,imageProps:K,actionProps:Y,collageCallback:ee,handleRemoveImage:te,options:X.options,tree:Q.tree}),xe=(0,C.jsx)(tt,{optionProps:X,actionProps:Y,dimensionProps:V,handleClear:le}),me=(0,C.jsx)(ce,{headerRef:V.headerRef,name:_,handlePreLogin:(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z("Saving collage locally"),e.next=3,he();case 3:M();case 4:case"end":return e.stop()}}),e)})))}),Ze=(0,C.jsx)(Te,{onDelete:Y.onDelete,onAdd:V.handleImageAddClick,clearDelete:Y.clearDelete}),be=(0,C.jsx)(Pe,{innerRef:V.footerRef,onRefresh:Y.onRefresh,photosComp:Ze,editComp:(0,C.jsx)(Ue,{optionProps:X}),handleClear:le,clearDelete:Y.clearDelete}),Ce=window.innerWidth<window.innerHeight,je=Ce?xe:be,we=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Y.handleSave();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=Ce?(0,C.jsx)(Ge,{actionsRef:V.actionsRef,onDownload:Y.handleDownload,onSave:we}):(0,C.jsx)(ke,{actionsRef:V.actionsRef,onDownload:Y.handleDownload,onSave:we});return(0,C.jsxs)(m.Z,{sx:{backgroundColor:"black",height:"100vh"},children:[(0,C.jsx)(fe,{open:Y.open,saveOpen:Y.saveOpen,saveStatusOpen:Y.saveStart,dimensionProps:V,imageProps:K,header:me,actions:ye,downloadDialog:de,saveDialog:ge,saveStatusDialog:pe,collage:ve,controls:je,status:x,saveType:c}),(0,C.jsx)("input",{ref:V.addImageRef,type:"file",hidden:!0,multiple:!0,accept:"image/*",onChange:K.handleLoad}),Y.generate?(0,C.jsx)(ue.Z,{title:"Creating collage ..."}):null,(0,C.jsx)(T.Z,{open:y,children:(0,C.jsx)(O.Z,{children:(0,C.jsxs)(A.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[(0,C.jsx)(H.Z,{}),(0,C.jsx)(Z.Z,{variant:"h6",children:I})]})})})]})}},9052:function(e,t,n){var a=n(74165),o=n(4942),r=n(15861),i=function(e){return Object.fromEntries(e.split(";").map((function(e){return e.split("=",2)})))};function l(){return(l=(0,r.Z)((0,a.Z)().mark((function e(t,n,r,i){var l,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=!1,e.next=3,i.validate((0,o.Z)({},t,n),{abortEarly:!1}).catch((function(e){return e}));case 3:return s=e.sent,r(""),s.inner&&(s.inner.forEach((function(e){return r(e.message)})),l=!0),e.abrupt("return",!l);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.Z={parseCookie:i,getUserInfo:function(){var e=i(document.cookie);return"userInfo"in e?JSON.parse(atob(e.userInfo)):""},handleMaxPhotos:function(e){return e<450?{maxPhotos:2}:e<800?{maxPhotos:3}:{maxPhotos:4}},handleColumns:function(e){return e<450?2:e<800?3:4},handleArrangement:function(e,t){var n=0,a=0;e.forEach((function(e){e.height>e.width?a+=1:n+=1})),t(n>a?"rows":"columns")},isFieldValid:function(e,t,n,a){return l.apply(this,arguments)}}},7690:function(e,t,n){e.exports=n.p+"static/media/collage_back1.ec1522362d214f985aef.webp"}}]);
//# sourceMappingURL=621.35cfde6e.chunk.js.map